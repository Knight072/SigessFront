<h2>{{ isEdit ? 'Editar incidente' : 'Nuevo incidente' }}</h2>

<div *ngIf="error" style="color:#b00020;">{{ error }}</div>

<form [formGroup]="form" (ngSubmit)="save()" style="max-width:760px; display:grid; gap:10px;">
  <div>
    <label>Título</label><br />
    <input formControlName="title" />
  </div>

  <div>
    <label>Descripción</label><br />
    <textarea formControlName="description" rows="4"></textarea>
  </div>

  <div style="display:flex; gap:10px; flex-wrap:wrap;">
    <div>
      <label>Tipo</label><br />
      <input formControlName="type" placeholder="accidente / casi incidente..." />
    </div>
    <div>
      <label>Nivel</label><br />
      <select formControlName="level">
        <option value="BAJO">BAJO</option>
        <option value="MEDIO">MEDIO</option>
        <option value="ALTO">ALTO</option>
      </select>
    </div>
    <div>
      <label>Estado</label><br />
      <select formControlName="status">
        <option value="ABIERTO">ABIERTO</option>
        <option value="EN_ANALISIS">EN_ANALISIS</option>
        <option value="CERRADO">CERRADO</option>
      </select>
    </div>
  </div>

  <div style="display:flex; gap:10px; flex-wrap:wrap;">
    <div>
      <label>Fecha</label><br />
      <input type="date" formControlName="incidentDate" />
    </div>
    <div>
      <label>Responsable</label><br />
      <input formControlName="responsible" />
    </div>
    <div>
      <label>Área</label><br />
      <input formControlName="area" />
    </div>
  </div>

  <!-- version para optimistic locking (en edit) -->
  <div *ngIf="isEdit">
    <label>Version</label><br />
    <input type="number" formControlName="version" readonly />
  </div>

  <div style="display:flex; gap:10px;">
    <button type="submit" [disabled]="loading">{{ loading ? 'Guardando...' : 'Guardar' }}</button>
    <button type="button" (click)="cancel()">Cancelar</button>
  </div>
</form>
